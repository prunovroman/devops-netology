# Результаты домашнего задания "12.3 Развертывание кластера на собственных серверах, лекция 1"

Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру

Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
* Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

План расчета

1. Сначала сделайте расчет всех необходимых ресурсов.
2. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
4. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
5. Рассчитайте итоговые цифры.
6. В результате должно быть указано количество нод и их параметры.

---

| Сервер      | Количество      | RAM, Гб       | HDD, Гб         | CPU, ядро  | всего RAM, Гб     | всего CPU, ядер   | всего HDD, Гб  |
| :---------- |:---------------:|:-------------:|:---------------:|:----------:|:-----------------:|:-----------------:|:--------------:|
| DB          | 3               | 4             | 20              | 1          | 12                | 3                 | 60             |
| Cache       | 3               | 4             | 10              | 1          | 12                | 3                 | 30             |
| Frontend    | 5               | 0.05          | 1               | 0.2        | 0.25              | 1                 | 5              |
| Backend     | 10              | 0.6           | 5               | 1          | 6                 | 10                | 50             |
| Итого       |                 |               |                 |            | 30.25             | 17                | 145            |

Оптимальное количество рабочих нод **4 шт.**
Минимальный расчет количества ресурсов на одну рабочую ноду:

|Тип сервера    | Количество   | CPU, ядро     | ОЗУ, ГБ         | HDD, ГБ        |
|:------------- |:------------:| :------------:| :-------------: | :-------------:|
| Worker node   |1             |17/4 = 4.25    |30,25/4 = 7.5    |145/4 = 36.25   |

В случае выхода из строя одной из нод, необходимо добавить резерв 1.5 и запас нагрузки в 20%:

|Тип сервера    | Количество   | CPU, ядро          | ОЗУ, ГБ            | HDD, ГБ             |
|:------------- |:------------:| :-----------------:| :----------------: | :------------------:|
| Worker node   |1             |4.25*1.5*0.20 ~= 8  |7.5*1.5*0.20 ~= 14  |36.25*1.5*0.20 ~= 66 |

**ИТОГО**:  
Для worker node требуется 4 ноды по:  
> CPU - 8 core  
> RAM - 14 Gb  
> HDD - 66 Gb  

Для control plane требуется 3 ноды по:  
> CPU - 2 core  
> RAM - 2 Gb  
> HDD - 50 Gb  
