# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è "12.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Kubernetes"

–í—ã DevOps –∏–Ω–∂–µ–Ω–µ—Ä –≤ –∫—Ä—É–ø–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ —Å –±–æ–ª—å—à–∏–º –ø–∞—Ä–∫–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å —ç—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ã –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ.

## –ó–∞–¥–∞—á–∞ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Minikube

–î–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–∞—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Kubernetes. –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Ä–∞–±–æ—á–µ–π –º–∞—à–∏–Ω–µ Minikube.

### –ö–∞–∫ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ AWS

- —Å–æ–∑–¥–∞—Ç—å EC2 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É (Ubuntu Server 20.04 LTS (HVM), SSD Volume Type) —Å —Ç–∏–ø–æ–º **t3.small**. –î–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Security Group –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ ssh. –ù–µ –∑–∞–±—É–¥—å—Ç–µ —É–∫–∞–∑–∞—Ç—å keypair, –æ–Ω –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
- –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ ssh (ssh ubuntu@<ipv4_public_ip> -i <keypair>.pem)
- —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–∏–Ω–∏–∫—É–± –∏ –¥–æ–∫–µ—Ä —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏:
  - curl -LO <https://storage.googleapis.com/kubernetes-release/release/>`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
  - chmod +x ./kubectl
  - sudo mv ./kubectl /usr/local/bin/kubectl
  - sudo apt-get update && sudo apt-get install docker.io conntrack -y
  - curl -Lo minikube <https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64> && chmod +x minikube && sudo mv minikube /usr/local/bin/
- –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π minikube version
- –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ root –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –º–∏–Ω–∏–∫—É–±: minikube start --vm-driver=none
- –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å: minikube status
- –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –∫–æ–º–∞–Ω–¥–æ–π: kubectl get pods --namespace=kube-system

### –î–ª—è —Å–±—Ä–æ—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å—Ç–æ–∏—Ç —É–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –∏ —Å–æ–∑–¥–∞—Ç—å –∑–∞–Ω–æ–≤–æ

- minikube delete
- minikube start --vm-driver=none

–í–æ–∑–º–æ–∂–Ω–æ, –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É: sudo sysctl fs.protected_regular=0

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Minikube - [—Å—Å—ã–ª–∫–∞](https://kubernetes.io/ru/docs/tasks/tools/install-minikube/)

**–í–∞–∂–Ω–æ**: t3.small –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤–æ free tier, —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –±—é–¥–∂–µ—Ç–æ–º –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —É–¥–∞–ª—è–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª–∫—É.

---

```bash
    ubuntu@ubuntu-VirtualBox:~$ minikube version
    minikube version: v1.26.1
    commit: 62e108c3dfdec8029a890ad6d8ef96b6461426dc
```

```bash
    ubuntu@ubuntu-VirtualBox:~$ kubectl version --output=yaml
        clientVersion:
        buildDate: "2022-08-23T17:44:59Z"
        compiler: gc
        gitCommit: a866cbe2e5bbaa01cfd5e969aa3e033f3282a8a2
        gitTreeState: clean
        gitVersion: v1.25.0
        goVersion: go1.19
        major: "1"
        minor: "25"
        platform: linux/amd64
    kustomizeVersion: v4.5.7
    serverVersion:
        buildDate: "2022-07-13T14:23:26Z"
        compiler: gc
        gitCommit: aef86a93758dc3cb2c658dd9657ab4ad4afc21cb
        gitTreeState: clean
        gitVersion: v1.24.3
        goVersion: go1.18.3
        major: "1"
        minor: "24"
        platform: linux/amd64
```

```bash
    ubuntu@ubuntu-VirtualBox:~$ minikube status
    minikube
    type: Control Plane
    host: Running
    kubelet: Running
    apiserver: Running
    kubeconfig: Configured
```

```bash
    ubuntu@ubuntu-VirtualBox:~$ kubectl get pods --namespace=kube-system
    NAME                                        READY   STATUS    RESTARTS   AGE
    coredns-6d4b75cb6d-vvvrc                    0/1     Pending   0          10m
    etcd-ubuntu-virtualbox                      1/1     Running   0          10m
    kube-apiserver-ubuntu-virtualbox            1/1     Running   0          10m
    kube-controller-manager-ubuntu-virtualbox   1/1     Running   0          10m
    kube-proxy-v9wg6                            1/1     Running   0          10m
    kube-scheduler-ubuntu-virtualbox            1/1     Running   0          10m
    storage-provisioner                         0/1     Pending   0          10m

```

## –ó–∞–¥–∞—á–∞ 2: –ó–∞–ø—É—Å–∫ Hello World

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Minikube —Ç—Ä–µ–±—É–µ—Ç—Å—è –µ–≥–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å. –î–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥–æ–π–¥–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ hello world. –ê –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–º—É –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è ingress.

- —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —á–µ—Ä–µ–∑ Minikube —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ [—Ç—É—Ç–æ—Ä–∏–∞–ª—É](https://kubernetes.io/ru/docs/tutorials/hello-minikube/#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BB%D0%B0%D1%81%D1%82%D0%B5%D1%80%D0%B0-minikube)
- —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–¥–æ–Ω—ã ingress –∏ dashboard

---

```bash
    ubuntu@ubuntu-VirtualBox:~$ kubectl get deployments
    NAME         READY   UP-TO-DATE   AVAILABLE   AGE
    hello-node   1/1     1            1           2m13s
```

```bash
    ubuntu@ubuntu-VirtualBox:~$ kubectl get pods
    NAME                          READY   STATUS    RESTARTS   AGE
    hello-node-6d5f754cc9-2t78g   1/1     Running   0          3m25s

```

```bash
    ubuntu@ubuntu-VirtualBox:~$ kubectl get pods --all-namespaces
    NAMESPACE              NAME                                         READY   STATUS      RESTARTS      AGE
    default                hello-node-6d5f754cc9-2t78g                  1/1     Running     0             5m36s
    ingress-nginx          ingress-nginx-admission-create-t7s7x         0/1     Completed   0             18m
    ingress-nginx          ingress-nginx-admission-patch-5r6d2          0/1     Completed   0             18m
    ingress-nginx          ingress-nginx-controller-755dfbfc65-86884    1/1     Running     0             18m
    kube-system            coredns-6d4b75cb6d-pkqkn                     1/1     Running     0             58m
    kube-system            etcd-minikube                                1/1     Running     0             58m
    kube-system            kube-apiserver-minikube                      1/1     Running     0             58m
    kube-system            kube-controller-manager-minikube             1/1     Running     0             58m
    kube-system            kube-proxy-qb6gc                             1/1     Running     0             58m
    kube-system            kube-scheduler-minikube                      1/1     Running     0             58m
    kube-system            storage-provisioner                          1/1     Running     1 (58m ago)   58m
    kubernetes-dashboard   dashboard-metrics-scraper-78dbd9dbf5-8m6jp   1/1     Running     0             57m
    kubernetes-dashboard   kubernetes-dashboard-5fd5574d9f-d74mt        1/1     Running     0             57m
```

## –ó–∞–¥–∞—á–∞ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å kubectl

–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–∞–±–æ—á—É—é –º–∞—à–∏–Ω—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º –∫–ª–∞—Å—Ç–µ—Ä–æ–º. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ kubectl.

- –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ minikube
- –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –∑–∞–¥–∞–Ω–∏—è 2, –∑–∞–ø—É—Å—Ç–∏–≤ port-forward –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

---
<<<<<<< HEAD

```bash
    ubuntu@ubuntu-VirtualBox:~$ kubectl expose deployment hello-node --type=LoadBalancer --port=8080
    service/hello-node exposed
    
    ubuntu@ubuntu-VirtualBox:~$ kubectl get services
    NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    hello-node   LoadBalancer   10.106.66.114   <pending>     8080:30702/TCP   8s
    kubernetes   ClusterIP      10.96.0.1       <none>        443/TCP          60m

    ubuntu@ubuntu-VirtualBox:~$ minikube service hello-node
    |-----------|------------|-------------|---------------------------|
    | NAMESPACE |    NAME    | TARGET PORT |            URL            |
    |-----------|------------|-------------|---------------------------|
    | default   | hello-node |        8080 | http://192.168.49.2:30702 |
    |-----------|------------|-------------|---------------------------|
    üéâ  Opening service default/hello-node in default browser...

```

–í—ã–≤–æ–¥ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

```html
CLIENT VALUES:
client_address=172.17.0.1
command=GET
real path=/
query=nil
request_version=1.1
request_uri=http://192.168.49.2:8080/

SERVER VALUES:
server_version=nginx: 1.10.0 - lua: 10001

HEADERS RECEIVED:
accept=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
accept-encoding=gzip, deflate
accept-language=en-US,en;q=0.5
connection=keep-alive
host=192.168.49.2:30702
upgrade-insecure-requests=1
user-agent=Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:104.0) Gecko/20100101 Firefox/104.0
BODY:
-no body in request-
```
=======
>>>>>>> 51f7e9d8e91eb4af429cb1cbace2f85ff6a337d7
